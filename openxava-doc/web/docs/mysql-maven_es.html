<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Configuración para MySQL - OpenXava</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
    <link rel="stylesheet" href="highlight/highlight.css">
    <script src="highlight/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="wiki" style="display: block;">
      <h1 id="toc0"> <span id="breadcrumbs"> <span id="openxava"> <a href="https://www.openxava.org/">
              <span>o</span>pen<span>x</span>ava </a> </span> / <a href="index_es.html">documentación</a>
          / </span> Configuración para MySQL</h1>
      <i>Si estás usando una versión de OpenXava anterior a la 7.0 mira las <a
          href="mysql-ox6_es.html">instrucciones antiguas</a></i>
      <div class="wiki" style="display: block;">Configurar tu aplicación
        OpenXava contra MySQL es muy fácil, básicamente has de añadir una
        dependencia al controlador JDBC para MySQL en tu proyecto y definir
        correctamente la base de datos. No necesitas tocar el código de tu
        aplicación.</div>
      <div class="wiki" style="display: block;">Asumimos que ya tienes el MySQL
        instalado y funcionando.<br>
        <h2 id="toc1">Añadir controlador JDBC para MySQL en el proyecto</h2>
        <p>Edita el archivo <i>pom.xml</i> en la raíz de tu proyecto, allí
          añade la siguiente dependencia dentro de la parte <i>&lt;dependencies&gt;</i>:</p>
        <pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;version&gt;8.0.29&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>Quizás ya tengas este código en tu <i>pom.xml</i> pero comentado,
        en ese caso simplemente descoméntalo.</div>
      <div class="wiki" style="display: block;"> </div>
      <div class="wiki" style="display: block;">
        <h2 id="toc1">Ajustar la definición de la fuente de datos</h2>
        Edita <i>src/main/webapp/META-INF/context.xml</i> de tu proyecto y
        ajusta la definición de tu fuente de datos para que apunte a MySQL, algo
        así:</div>
      <div class="wiki" style="display: block;">
        <pre><code class="xml">&lt;Resource name="jdbc/MiAplicacionDS" auth="Container"
	type="javax.sql.DataSource"
	maxTotal="100" maxIdle="20" maxWaitMillis="10000"
	username="root" password="ao49fmsk"
	url="jdbc:mysql://localhost:3306/"/&gt;
</code></pre> </div>
      <div class="wiki" style="display: block;">La diferencia es <i>url</i>.
        Obviamente, en lugar de <i>localhost</i> deberías poner la dirección
        del servidor que alberga MySQL. También pon el <i>username</i> y <i>password</i>
        correctos. Puede que el código de arriba ya esté en tu <i>context.xml</i>
        pero comentado, en ese caso simplemente descoméntalo. No olvides
        comentar o quitar la fuente de datos para HSQLDB (incluida por defecto
        al crear un nuevo proyecto OpenXava), sólo una fuente de datos (con el
        mismo nombre) debería estar activa.</div>
      <div class="wiki" style="display: block;">
        <h2 id="toc1">Actualizar persistence.xml</h2>
        En la unidad de persistencia <i>default</i> de <i>persistence.xml</i>
        (en <i>src/main/resources/META-INF</i>)
        tienes que cambiar <i>hibernate.default_schema</i> property por <i>hibernate.default_catalog</i>:
        <br>
        <div class="wiki" style="display: block;">
          <pre><code class="xml">&lt;persistence-unit name="default"&gt;
	&lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;
	&lt;non-jta-data-source&gt;java://comp/env/jdbc/MiAplicacionDS&lt;/non-jta-data-source&gt;
	&lt;class&gt;org.openxava.session.GalleryImage&lt;/class&gt;
	&lt;class&gt;org.openxava.web.editors.DiscussionComment&lt;/class&gt;
	&lt;properties&gt;
		&lt;property name="javax.persistence.schema-generation.database.action" value="update"/&gt;
		&lt;property name="javax.persistence.create-database-schemas" value="true"/&gt; 
		&lt;property name="hibernate.default_catalog" value="miaplicaciondb"/&gt;
		&lt;property name="hibernate.jdbc.use_streams_for_binary" value="true"/&gt;
	&lt;/properties&gt;
&lt;/persistence-unit&gt;
</code></pre> </div>
        Fíjate como usamos <i>hibernate.default_catalog</i> para indicar tu
        base de datos MySQL, en este caso <i>miaplicacionb</i>. Quizás este
        código ya está en tu <i>persistence.xml</i> pero comentado, en ese caso
        simplemente descoméntalo. No olvides comentar o quitar la otra unidad de
        persistencia <i>default</i>, sólo una unidad de persistence (con el
        mismo nombre) debería estar activa.</div>
      <div class="wiki" style="display: block;">
        <h2>Reconstruir proyecto</h2>
        <p>Después de los cambios has de reconstruir (rebuild) tu proyecto. Con
          OpenXava Studio ejecuta <i>Run As &gt; Maven install</i> en tu
          proyecto, así:</p>
        <p>TMR FALTA. PANTALLAZO CON WINDOWS 10</p>
        <p>O si tienes Maven instalado en tu ordenador y prefieres usar la línea
          de órdenes:</p>
        <pre><code class="bash">$ cd miaplicacion
$ mvn install
</code></pre>
        <p>Nota de optimización: En lugar de <i>mvn install</i>, que hace un <i>build</i>
          de Maven completo, puedes usar <i>mvn war:exploded</i>, suficiente
          para aplicar los cambios de arriba para desarrollo. Puedes llamar a <i>mvn
            war:exploded</i> desde el OpenXava Studio con <i>Run As &gt; Maven
            build...</i> y tecleando <i>package:exploded</i> para <i>goal</i>.</p>
        <h2>Ejecutar aplicacion</h2>
        <p>Ejecuta tu aplicación, debería funcionar bien contra tu base de datos
          MySQL. Si fallara, verifica que tu base de datos está funcionando, que
          el usuario y la contraseña son correcto, que la IP del servidor es
          correcta. Verifica también el usuario tiene privilegios para crear
          bases de datos y tablas (si quieres usar la generación automática de
          esquema de OpenXava, no necesario si las tablas ya existen).</p>
        <p>Si sigue fallando pregúntanos en el <a href="https://sourceforge.net/p/openxava/discussion/437013/">foro
            de ayuda de OpenXava</a>. Incluye el contenido de tu <i>persistence.xml</i>,
          <i>context.xml</i> (quita las contraseñas) y sobre todo la traza
          generada, puedes encontrar la traza en la pestaña <i>Console</i> del
          OpenXava Studio.</p>
      </div>
    </div>
  </body>
</html>
