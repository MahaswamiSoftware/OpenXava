<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>OpenXava - SSO con Azure AD</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
    <link rel="stylesheet" href="highlight/highlight.css">
    <script src="highlight/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="wiki" style="display: block;">
      <h1 id="toc0"><a name="configuracion-para-kotlin"></a> <span id="breadcrumbs">
          <span id="openxava"> <a href="https://www.openxava.org/"> <span>o</span>pen<span>x</span>ava
              </a> </span> / <a href="index_es.html">documentación</a> / </span>SSO
        con Azure AD</h1>
      <em>Todas las funcionalidades en este artículo están disponible solo en <a
          href="http://openxava.org/xavapro">XavaPro</a></em></div>
    <div class="wiki" style="display: block;"> Desde XavaPro 7.1 puedes
      configurar la identificación de usuarios para que use Azure AD, lo que te
      permite usar <b>SSO</b> (inicio de sesión único). De esta manera el
      usuario se puede identificar una solo vez y acceder a todas las
      aplicaciones XavaPro y a otras aplicaciones no XavaPro que también usen
      Azure AD. Además, usar Azure AD te permite usar <b>autentificación en 2
        pasos</b> para tus aplicaciones XavaPro. <br>
      <h2><a name="añadir-dependencias-en-pom.xml">Configuración Azure AD en
          XavaPro</a></h2>
      En la carpeta Admin tienes un módulo llamado SSO para configurar Azure AD:<code
        class="xml"></code> </div>
    <img src="files/sso-module_es.png">
    <div class="wiki" style="display: block;">Si marcas las casilla de <i>Activado</i>
      y rellenas los demás campos con la configuración correcta de tu Azure AD
      para tu aplicación, al identificarte tendrás un nuevo botón INICIAR SESIÓN
      CON AZURE AD:</div>
    <img src="files/sigin-in-with-azuread_es.png" alt="">
    <div class="wiki" style="display: block;">Si el usuario pulsa en INICIAR
      SESIÓN CON AZURE AD se le dará la opción de identificarse usando sus
      credenciales de Azure. Además, si el usuario ya estuviera identificado en
      ese navegador accedería a la aplicación sin que se le pidiera
      identificación, aunque para eso el usuario tiene que estar añadido a la
      aplicación en la configuración de Azure AD y además dado de alta como
      usuario XavaPro en la aplicación y asignados los roles correspondientes.
      Ojo,&nbsp; <b>el usuario ha de estar dado de alta en la aplicación
        XavaPro</b> con el mismo nombre que en Azure, sino no se podrá acceder a
      la aplicación.<br>
      <h2><a name="prueba-una-entidad-simple">Configurar la aplicación en Azure
          AD</a></h2>
      Si ya usas Azure AD en tu organización estarás acostumbrado a configurar
      aplicaciones y asignar usuarios a ellos, tendrás claro, además, de donde
      sacar los valores para el formulario de SSO de XavaPro. Pero si nunca has
      usado Azure AD, no te preocupes, aquí te presentamos una guía para
      registrar tu aplicación en Azure AD. Azure AD ofrece una capa gratuita
      suficiente para tener SSO en tus aplicaciones XavaPro. </div>
    <div class="wiki" style="display: block;">Lo primero es darte de alta en
      Azure AD, en esta dirección:
      https://azure.microsoft.com/es-es/products/active-directory (si el vínculo
      no funciona busca en Google por "Azure AD").</div>
    <div class="wiki" style="display: block;">Una vez dado de alta ve a la
      página principal de Azure, normalmente al identificarte entra ahí, sino ve
      a https://portal.azure.com/. Allí pulsa en Azure AD:</div>
    <img src="files/azure-menu-azure-ad-option_es.png" alt="">
    <div class="wiki" style="display: block;">Esto te lleva a la página de
      administración de Azure AD:</div>
    <img src="files/azure-ad-dashboard_es.png" alt="">
    <div class="wiki" style="display: block;">Supongamos que tenemos una
      aplicación XavaPro llamada <i>facturacion</i> y queremos registrarla en
      AzureAD, deberíamos de seguir estos pasos:</div>
    <div class="wiki" style="display: block;">Primero abre el menú <i>Agregar</i>
      y pulsa en <i>Registro de aplicación</i>:</div>
    <img src="files/azure-ad-add-app-registration_es.png" alt="">
    <div class="wiki" style="display: block;">
      <div> In the <strong>Register an application page</strong> that appears,
        enter your application's registration information:
        <ul>
          <li>In the <strong>Name</strong> section, enter facturacion.</li>
          <li>Under <strong>Supported account types</strong>, select <strong>Accounts
              in this organizational directory only</strong>. ()</li>
          <li>In the <strong>Redirect URI</strong> section, select <strong>Web</strong>
            in the combo-box and enter the following redirect URI: <code>http://localhost:8080/facturacion/sso/azure/redirect</code></li>
        </ul>
        <img src="files/azure-ad-app-registration-form_es.png" alt="">
        <ol>
          <li><br>
          </li>
          <li>Select <strong>Register</strong> to create the application.</li>
        </ol>
        <p>En la página de administración de Azure AD, escoge la opción <i>Registros
            de aplicaciones</i> en el menú de la izquierda. Esto te mostrará la
          lista de tus aplicaciones, pulsa en <i>facturacion</i>.</p>
        <img src="files/azure-ad-app-registration-choose-app_es.png" alt="">
        <ol>
          <li>In the app's registration screen, click on the <strong>Certificates
              &amp; secrets</strong> blade in the left to open the page where we
            can generate secrets and upload certificates.</li>
        </ol>
        <img src="files/azurea-ad-app-info-add-secret_es.png" alt="">
        <p><br>
        </p>
        <ol>
          <li>In the <strong>Client secrets</strong> section, click on <strong>New
              client secret</strong>: </li>
        </ol>
        <img src="files/azure-ad-new-client-secret-option_es.png" alt=""><br>
        <ol>
          <li>
            <ul>
              <li>Type a key description (for instance secreto aplicación),</li>
              <li>Select one of the available key durations (<strong>In 1 year</strong>,
                <strong>In 2 years</strong>, or <strong>Never Expires</strong>)
                as per your security concerns.</li>
            </ul>
          </li>
        </ol>
        <img src="files/azure-ad-app-secret-form_es.png" alt="">
        <ol>
          <li>
            <ul>
              <li>The generated key value will be displayed when you click the <strong>Add</strong>
                button. Copy the generated value for use in the steps later.</li>
            </ul>
            <ul>
              <li>You'll need this key later in your code's configuration files.
                This key value will not be displayed again, and is not
                retrievable by any other means, so make sure to note it from the
                Azure portal before navigating to any other screen or blade.</li>
            </ul>
          </li>
        </ol>
        <img src="files/azure-ad-secret-value_es.png" alt="">
        <p><br>
        </p>
        <ol>
          <li>
            <ul>
            </ul>
          </li>
          <li>In the app's registration screen, select the <strong>API
              permissions</strong> blade in the left to open the page where we
            add access to the APIs that your application needs.
            <ul>
              <li>Select the <strong>Add a permission</strong> button and then:</li>
              <li>Ensure that the <strong>Microsoft APIs</strong> tab is
                selected.
                <ul>
                  <li>In the <em>Commonly used Microsoft APIs</em> section,
                    select <strong>Microsoft Graph</strong></li>
                  <li>In the <strong>Delegated permissions</strong> section,
                    select <strong>User.Read</strong> and <strong>GroupMember.Read.All</strong>
                    in the list. Use the search box if necessary.</li>
                  <li>Select the <strong>Add permissions</strong> button at the
                    bottom.</li>
                </ul>
              </li>
              <li><strong>GroupMember.Read.All</strong> requires admin consent.
                Select the <strong>Grant/revoke admin consent for {tenant}</strong>
                button, and then select <strong>Yes</strong> when you are asked
                if you want to grant consent for the requested permissions for
                all accounts in the tenant. You need to be an Azure AD tenant
                admin to do this.</li>
            </ul>
          </li>
        </ol>
      </div>
    </div>
    <div class="wiki" style="display: block;"><br>
    </div>
  </body>
</html>
