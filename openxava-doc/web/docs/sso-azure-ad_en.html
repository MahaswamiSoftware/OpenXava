<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>OpenXava - SSO with Azure AD</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
    <link rel="stylesheet" href="highlight/highlight.css">
    <script src="highlight/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="wiki" style="display: block;">
      <h1 id="toc0"><a name="configuracion-para-kotlin"></a> <span id="breadcrumbs">
          <span id="openxava"> <a href="https://www.openxava.org/"> <span>o</span>pen<span>x</span>ava
              </a> </span> / <a href="index_en.html">documentation</a> / </span>SSO
        with Azure AD</h1>
      <em>Todas las funcionalidades en este artículo están disponible solo en <a
          href="http://openxava.org/xavapro">XavaPro</a></em></div>
    <div class="wiki" style="display: block;"> Desde XavaPro 7.1 puedes
      configurar la identificación de usuarios para que use Azure AD, lo que te
      permite usar <b>SSO</b> (inicio de sesión único). De esta manera el
      usuario se puede identificar una solo vez y acceder a todas las
      aplicaciones XavaPro y a otras aplicaciones no XavaPro que también usen
      Azure AD. Además, usar Azure AD te permite usar <b>autentificación en 2
        pasos</b> para tus aplicaciones XavaPro. <br>
      <h2><a name="añadir-dependencias-en-pom.xml">Configuración SSO en XavaPro</a></h2>
      En la carpeta Admin tienes un módulo llamado SSO para configurar Azure AD:<code
        class="xml"></code> </div>
    <img src="files/sso-module_en.png">
    <div class="wiki" style="display: block;">Si marcas las casilla de <i>Activado</i>
      y rellenas los demás campos con la configuración correcta de tu Azure AD
      para tu aplicación, al identificarte tendrás un nuevo botón INICIAR SESIÓN
      CON AZURE AD:</div>
    <img src="files/sigin-in-with-azuread_en.png">
    <div class="wiki" style="display: block;">Si el usuario pulsa en INICIAR
      SESIÓN CON AZURE AD se le dará la opción de identificarse usando sus
      credenciales de Azure. Además, si el usuario ya estuviera identificado en
      ese navegador accedería a la aplicación sin que se le pidiera
      identificación, aunque para eso el usuario tiene que estar añadido a la
      aplicación en la configuración de Azure AD y además dado de alta como
      usuario XavaPro en la aplicación y asignados los roles correspondientes.
      Ojo,&nbsp; <b>el usuario ha de estar dado de alta en la aplicación
        XavaPro</b> con el mismo nombre que en Azure, sino no se podrá acceder a
      la aplicación.<br>
      <h2>Configurar la aplicación en Azure AD</h2>
      Si ya usas Azure AD en tu organización estarás acostumbrado a configurar
      aplicaciones y asignar usuarios a ellos, tendrás claro, además, de donde
      sacar los valores para el formulario de SSO de XavaPro. Pero si nunca has
      usado Azure AD, no te preocupes, aquí te presentamos una guía para
      registrar tu aplicación en Azure AD. Azure AD ofrece una capa gratuita
      suficiente para tener SSO en tus aplicaciones XavaPro. </div>
    <div class="wiki" style="display: block;">
      <h3>Panel de control de Azure AD</h3>
    </div>
    <div class="wiki" style="display: block;">Lo primero es darte de alta en
      Azure AD, en esta dirección:
      https://azure.microsoft.com/es-es/products/active-directory (si el vínculo
      no funciona busca en Google por "Azure AD").</div>
    <div class="wiki" style="display: block;">Una vez dado de alta ve a la
      página principal de Azure, normalmente al identificarte entra ahí, sino ve
      a https://portal.azure.com/. Allí pulsa en Azure AD:</div>
    <img src="files/azure-menu-azure-ad-option_en.png">
    <div class="wiki" style="display: block;">Esto te lleva a la página de
      administración de Azure AD:</div>
    <img src="files/azure-ad-dashboard_en.png">
    <div class="wiki" style="display: block;">
      <h3>Agregar aplicación en Azure AD</h3>
    </div>
    <div class="wiki" style="display: block;">Supongamos que tenemos una
      aplicación XavaPro llamada <i>facturacion</i> y queremos registrarla en
      AzureAD, deberíamos de seguir estos pasos:</div>
    <div class="wiki" style="display: block;">Primero abre el menú <i>Agregar</i>
      y pulsa en <i>Registro de aplicación</i>:</div>
    <img src="files/azure-ad-add-app-registration_en.png">
    <div class="wiki" style="display: block;">
      <div> In the <strong>Register an application page</strong> that appears,
        enter your application's registration information:
        <ul>
          <li>In the <strong>Name</strong> section, enter facturacion.</li>
          <li>Under <strong>Supported account types</strong>, select <strong>Accounts
              in this organizational directory only</strong>. ()</li>
          <li>In the <strong>Redirect URI</strong> section, select <strong>Web</strong>
            in the combo-box and enter the following redirect URI: <code>http://localhost:8080/facturacion/sso/azure/redirect</code></li>
        </ul>
        <img src="files/azure-ad-app-registration-form_en.png">
        <ol>
        </ol>
        Select <strong>Register</strong> to create the application.
        <ol>
        </ol>
        <h3>Crear secreto</h3>
        <p>En la página de administración de Azure AD, escoge la opción <i>Registros
            de aplicaciones</i> en el menú de la izquierda. Esto te mostrará la
          lista de tus aplicaciones, pulsa en <i>facturacion</i>.</p>
        <img src="files/azure-ad-app-registration-choose-app_en.png">
        <ol>
        </ol>
        In the app's registration screen, click on the <strong>Certificates
          &amp; secrets</strong> blade in the left to open the page where we can
        generate secrets and upload certificates. In the <strong>Client secrets</strong>
        section, click on <strong>New client secret</strong>:
        <ol>
        </ol>
        <img src="files/azure-ad-new-client-secret-option_en.png"><br>
        <p>Type a key description (for instance secreto aplicación), Select one
          of the available key durations (<strong>In 1 year</strong>, <strong>In
            2 years</strong>, or <strong>Never Expires</strong>) as per your
          security concerns.</p>
        <ol>
        </ol>
        <img src="files/azure-ad-app-secret-form_en.png">
        <ol>
        </ol>
        <p>The generated key value will be displayed when you click the Add
          button. Copy the generated value for use in the steps later. You'll
          need this key later in your code's configuration files. This key value
          will not be displayed again, and is not retrievable by any other
          means, so make sure to note it from the Azure portal before navigating
          to any other screen or blade.</p>
        <ol>
        </ol>
        <img src="files/azure-ad-secret-value_en.png"></div>
      <div>
        <h2>Configurar la aplicación Azure AD en XavaPro</h2>
        <p>En Azure AD ve a Registros de aplicaciones y ahí escoge tu
          aplicación, para ver su Información esencial. Después en tu aplicación
          XavaPro abre el módulo SSO dentro de Admin y rellena:</p>
        <ul>
          <li>Id del cliente en XavaPro con el Id. de aplicación (cliente) de
            Azure AD.</li>
          <li>En Autoridad de XavaPro pone el prefijo
            https://login.microsoftonline.com/ y añádele el Id. de directorio
            (inquilino) de Azure AD.</li>
          <li>En Secreto de XavaPro añade el secreto aplicación que has creado
            en el paso anterior y se supone te has apuntado.</li>
        </ul>
        <p>Como sigue:</p>
        <img src="files/azure-ad-sso-xavapro-from-azure-conf_en.png">
        <p>Marca la casilla de Activado y tu aplicación ya trabajará con Azure
          AD. Recuerda dar de alta los usuarios en tu aplicación XavaPro con los
          roles correspondientes, sino no te funcionará. Si haces esto con otras
          aplicaciones XavaPro podrás identificarte la primera vez y acceder a
          las demás aplicaciones sin identificarte, además puedes activar la
          autentificación en dos pasos en tus usuarios desde Azure AD.</p>
      </div>
    </div>
  </body>
</html>
