<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Spring Boot</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
    <link rel="stylesheet" href="highlight/highlight.css">
    <script src="highlight/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="wiki" style="display: block;">
      <h1 id="toc0"> <span id="breadcrumbs"> <span id="openxava"> <a
              href="https://www.openxava.org/"> <span>o</span>pen<span>x</span>ava </a> </span> / <a
            href="index_es.html">documentación</a> / </span>Spring Boot</h1>
      Spring Boot es una herramienta que hace que el desarrollo de aplicaciones web y microservicios con Spring Framework sea más rápido y fácil.<br>
      En esta publicación integraremos OpenXava en una aplicación Spring Boot simple con servicios Rest y JPA para aprovechar la vista generada automáticamente por OpenXava. Tomaremos el proyecto de <a
        href="https://www.bezkoder.com/spring-boot-jpa-crud-rest-api/">BezKoder</a> como base, lo puedes descargar directamente <a
        href="https://github.com/bezkoder/spring-boot-data-jpa-mysql">aquí</a> e importarlo en <a
        href="https://spring.io/tools">Spring Tool Suite 4</a> for Eclipse. Así mismo vas a necesitar <a
        href="https://openxava.org/downloads/register">OpenXava Studio</a> y <a
        href="https://dev.mysql.com/downloads/mysql/">MySQL</a>. Al final levantaremos la aplicación en un servidor <a
        href="https://tomcat.apache.org/download-90.cgi">Tomcat 9</a>.</div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">Importar y configurar proyecto en Spring Tool Suite 4</h2>
      <p>Luego de descargar el proyecto, abre Spring Tool Suite 4 e importa el proyecto.<br>
        Configura application.properties ubicado en src/main/resources y adáptalo a tu base de datos MySQL.</p>
      <p><img src="files/springboot_010.png" alt=""></p>
      <p>Maven Update &gt; Maven Install &gt; inicia la aplicación como Spring Boot App.</p>
      <p><img src="files/springboot_020.png" alt=""></p>
      <p>Comprueba que los servicios funcionen correctamente ingresando a <a
          href="http://localhost:8080/api/tutorials">http://localhost:8080/api/tutorials</a></p>
      <div class="wiki" style="display: block;">
        <h2 id="toc1">Crear y configurar proyecto en OpenXava</h2>
        <p>Crea un nuevo proyecto OpenXava con OpenXava Studio.</p>
        <p><img src="files/getting-started_es020.png" alt="getting-started_es020.png"
            title="getting-started_es020.png"></p>
        <p><img src="files/springboot_030.png" alt=""></p>
        <p>Agrega el dialecto de MySQL8 o la versión que uses en el archivo persistence.xml ubicado en src/main/resources/META-INF.</p>
        <pre><code class="xml">&lt;property name="hibernate.dialect" value="org.hibernate.dialect.MySQL8Dialect"/&gt;</code></pre>
        <p><img src="files/springboot_040.png" alt=""></p>
        <p>Configura el archivo context.xml de la carpeta src/main/webapp/META-INF, comenta el resource de HSQLDB, usa el de MySQL y configura la conexión a la base de datos.</p>
        <p><img src="files/springboot_050.png" alt=""></p>
        <code class="xml"> </code></div>
      <div class="wiki" style="display: block;"> </div>
      <div class="wiki" style="display: block;">
        <h2 id="toc1">Reemplaza el archivo application.properties del proyecto Spring Boot</h2>
        Usaremos una de las maneras para integrar OpenXava en una aplicación Spring Boot, primero debes reemplazar el archivo application.properties configurándolo manualmente creando una clase @Configuration.</div>
      <div class="wiki" style="display: block;">Para esto crea una clase llamada AppConfig en el paquete com.bezkoder.spring.datajpa, dentro define las configuraciones de conexión a la base de datos, las entidades y repositorios a leer, por ejemplo:</div>
      <div class="wiki" style="display: block;">
        <pre><code class="java">@Configuration
@EnableJpaRepositories("com.bezkoder.spring.datajpa.repository")
@EnableTransactionManagement
public class AppConfig {

    @Bean
    public DataSource dataSource() {
        DriverManagerDataSource dataSource = new DriverManagerDataSource();
        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");
        dataSource.setUrl("jdbc:mysql://localhost:3306/database");
        dataSource.setUsername("root");
        dataSource.setPassword("");
        return dataSource;
    }

    @Bean
    public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
        LocalContainerEntityManagerFactoryBean entityManagerFactory = new LocalContainerEntityManagerFactoryBean();
        entityManagerFactory.setDataSource(dataSource());
        entityManagerFactory.setPackagesToScan("com.bezkoder.spring.datajpa.model");
        entityManagerFactory.setPersistenceUnitName("com.bezkoder.spring.datajpa.model");
        HibernateJpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();
        vendorAdapter.setDatabase(Database.MYSQL);
        vendorAdapter.setDatabasePlatform("org.hibernate.dialect.MySQL8Dialect");
        entityManagerFactory.setJpaVendorAdapter(vendorAdapter);
        entityManagerFactory.setJpaProperties(hibernateProperties());
        return entityManagerFactory;
    }

    private Properties hibernateProperties() {
        Properties properties = new Properties();
        properties.setProperty("hibernate.hbm2ddl.auto", "update");
        properties.setProperty("hibernate.dialect", "org.hibernate.dialect.MySQL8Dialect");
        return properties;
    }

}</code></pre>
      </div>
      <div class="wiki" style="display: block;"><img src="files/springboot_060.png"
          alt=""></div>
      <div class="wiki" style="display: block;">Elimina el archivo application.properties y prueba que los servicios sigan funcionando correctamente ingresando a <a
          href="http://localhost:8080/api/tutorials">http://localhost:8080/api/tutorials</a></div>
      <span style="color: #0000ee;">A</span>ñade extends SpringBootServletInitializer en SpringBootDataJpaApplication ubicado en el paquete com.bezkoder.spring.datajpa:
      <div class="wiki" style="display: block;">
        <pre><code class="java">@SpringBootApplication
public class SpringBootDataJpaApplication extends SpringBootServletInitializer {

	public static void main(String[] args) throws Exception {
		SpringApplication.run(SpringBootDataJpaApplication.class, args);

	}
}
</code></pre> </div>
      <div class="wiki" style="display: block;">Ahora configura el pom.xml agregando la dependencia de OpenXava, el finalName es opcional pero lo usaremos en este ejemplo:
        <div class="wiki" style="display: block;">
          <pre><code class="xml">&lt;packaging&gt;war&lt;/packaging&gt;<br><br>&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;org.openxava&lt;/groupId&gt;
        &lt;artifactId&gt;openxava&lt;/artifactId&gt;
        &lt;version&gt;7.1.1&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;<br><br>&lt;build&gt;
    &lt;finalName&gt;springbootdatajpa&lt;/finalName&gt;
&lt;/build&gt;<br></code></pre>
        </div>
      </div>
      <div class="wiki" style="display: block;">Por último, copia los siguientes archivos y carpetas del proyecto OpenXava al proyecto Spring Boot bajo la misma ruta:</div>
      <ul>
        <li>Todos los archivos y carpetas de src/main/resources.</li>
        <li>La carpeta webapp ubicado en src/main.</li>
      </ul>
      <p><img src="files/springboot_070.png" alt=""></p>
      <p>Opcional: modificar el archivo naviox.properties de la carpeta src/main/resources quitando # a las líneas de autologinUser y autologinPassword</p>
      <p><img src="files/springboot_080.png" alt=""></p>
      <p>Debería quedar con estos cambios:</p>
      <p><img src="files/springboot_090.png" alt=""></p>
      <ul>
      </ul>
      <div class="wiki" style="display: block;">
        <h2>Ejecutar aplicacion</h2>
        <p>Recuerda tener configurado JAVA_HOME y hacer los siguientes pasos antes de ejecutar la aplicación:</p>
        <ul>
          <li>Maven &gt; update project</li>
          <li>Maven clean</li>
          <li>Maven package</li>
        </ul>
        <p>Copia el archivo springbootdatajpa.war de la carpeta target a la carpeta webapp donde tienes instalado Tomcat 9 y ejecuta startup.bat desde la carpeta bin</p>
        <p><img src="files/springboot_100.png" alt=""></p>
        <p>Abre el navegador e ingresa al siguiente url para abrir la aplicación OpenXava (inicia sesión con admin/admin si no has hecho el paso opcional): <code><i><a
                href="http://localhost:8080/springbootdatajpa" target="_blank">http://localhost:8080/springbootdatajpa</a><br>
            </i></code></p>
        <p>Dentro podrás generar una vista con OpenXava aprovechando la entidad que tiene el proyecto y realizar operaciones CRUD.</p>
        <p>Comprueba que los servicios del proyecto Spring Boot estén funcionando: <a
            href="http://localhost:8080/springbootdatajpa/api/tutorials">http://localhost:8080/springbootdatajpa/api/tutorials</a></p>
        <p>Verás que en vez de devolver un json, está devolviendo un xml, esto es debido al bug de la libreria JasperReports que trae OpenXava, lo resolveremos momentáneamente en este ejemplo excluyendo una dependencia de esa libreria, que no es recomendable hacerlo en producción:</p>
        <pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.openxava&lt;/groupId&gt;
    &lt;artifactId&gt;openxava&lt;/artifactId&gt;
    &lt;version&gt;7.1.1&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;<br></code></pre>
        <p></p>
        <p>Si deseas quitar springbootdatajpa del url, simplemente renombra el archivo springbootdatajpa.war a ROOT.war ubicado en la carpeta de webapps, con esto ingresas a la aplicación OpenXava con el url <code><i><a
                href="http://localhost:8080/" target="_blank">http://localhost:8080</a></i></code>&nbsp; y a los servicios REST como antes con <a
            href="http://localhost:8080/api/tutorials">http://localhost:8080/api/tutorials</a><br>
          <code></code></p>
      </div>
    </div>
  </body>
</html>
