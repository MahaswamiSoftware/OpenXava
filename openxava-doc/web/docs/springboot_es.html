<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Spring Boot</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
    <link rel="stylesheet" href="highlight/highlight.css">
    <script src="highlight/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="wiki" style="display: block;">
      <h1 id="toc0"> <span id="breadcrumbs"> <span id="openxava"> <a
              href="https://www.openxava.org/"> <span>o</span>pen<span>x</span>ava </a> </span> / <a
            href="index_es.html">documentación</a> / </span>Spring Boot</h1>
      Spring Boot es una herramienta que hace que el desarrollo de aplicaciones web y microservicios con Spring Framework sea más rápido y fácil.<br>
      En esta publicación integraremos OpenXava en una aplicación Spring Boot simple con servicios Rest y JPA para aprovechar la vista generada automáticamente por OpenXava. Tomaremos el proyecto de <a
        href="https://www.bezkoder.com/spring-boot-jpa-crud-rest-api/">BezKoder</a> como base, lo puedes descargar directamente <a
        href="https://github.com/bezkoder/spring-boot-data-jpa-mysql">aquí</a> e importarlo en <a
        href="https://spring.io/tools">Spring Tool Suite 4</a> for Eclipse. Así mismo vas a necesitar <a
        href="https://openxava.org/downloads/register">OpenXava Studio</a> y <a
        href="https://dev.mysql.com/downloads/mysql/">MySQL</a>(usaremos MySQL8 en este ejemplo). Al final levantaremos la aplicación en un servidor <a
        href="https://tomcat.apache.org/download-90.cgi">Tomcat 9</a>.</div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">Importar y configurar proyecto en Spring Tool Suite 4</h2>
      <p>Descarga el proyecto como zip</p>
      <p><img src="files/springboot_004.png" alt=""></p>
      <p>Para importar el proyecto en Spring Tool Suite 4, debes seleccionarlo desde la carpeta donde lo has descomprimido</p>
      <p><img src="files/springboot_005.png" alt=""></p>
      <p><img src="files/springboot_006.png" alt=""></p>
      <p> Configura application.properties ubicado en src/main/resources, adáptalo a tu base de datos MySQL con tu url, username, password y dialecto, recuerda tener levantado la base de datos MySQL.</p>
      <p><img src="files/springboot_010.png" alt=""></p>
      <p>Maven Update Project &gt; Maven Install &gt; inicia la aplicación como Spring Boot App.</p>
      <p><img src="files/springboot_020.png" alt=""></p>
      <p>Crea algunos registros manualmente en MySQL, por ejemplo: </p>
      <p><img src="files/springboot_007.png" alt=""></p>
      <p>Comprueba que los servicios funcionen correctamente ingresando a <i><a
            href="http://localhost:8080/api/tutorials">http://localhost:8080/api/tutorials</a></i></p>
      <div class="wiki" style="display: block;">
        <h2 id="toc1">Crear y configurar proyecto en OpenXava</h2>
        <p>Crea un nuevo proyecto OpenXava con OpenXava Studio.</p>
        <p><img src="files/getting-started_es020.png" alt="getting-started_es020.png"
            title="getting-started_es020.png"></p>
        <p><img src="files/springboot_030.png" alt=""></p>
        <p>Agrega el dialecto de MySQL8 en el archivo <i>persistence.xml</i> ubicado en <i>src/main/resources/META-INF</i>.</p>
        <pre><code class="xml">&lt;property name="hibernate.dialect" value="org.hibernate.dialect.MySQL8Dialect"/&gt;</code></pre>
        <p><img src="files/springboot_040.png" alt=""></p>
        <p>Configura el archivo <em>context.xml</em> de la carpeta <em>src/main/webapp/META-INF</em>, comenta el resource de HSQLDB, usa el de MySQL y configura la conexión a la base de datos.</p>
        <p><img src="files/springboot_050.png" alt=""></p>
        <code class="xml"> </code></div>
      <div class="wiki" style="display: block;"> </div>
      <div class="wiki" style="display: block;">
        <h2 id="toc1">Reemplazar application.properties y copiar archivos al proyecto Spring Boot</h2>
        Usaremos una de las maneras para integrar OpenXava en una aplicación Spring Boot, primero debes reemplazar el archivo <em>application.properties</em> configurándolo manualmente creando una clase <em>@Configuration</em>.</div>
      <div class="wiki" style="display: block;">Para esto crea una clase llamada <em>AppConfig</em> en el paquete <em>com.bezkoder.spring.datajpa</em>, dentro define las configuraciones de conexión a la base de datos, las entidades y repositorios a leer, por ejemplo:</div>
      <div class="wiki" style="display: block;">
        <pre><code class="java">@Configuration
@EnableJpaRepositories("com.bezkoder.spring.datajpa.repository")
@EnableTransactionManagement
public class AppConfig {

    @Bean
    public DataSource dataSource() {
        DriverManagerDataSource dataSource = new DriverManagerDataSource();
        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");
        dataSource.setUrl("jdbc:mysql://localhost:3306/yourdatabase");
        dataSource.setUsername("root");
        dataSource.setPassword("");
        return dataSource;
    }

    @Bean
    public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
        LocalContainerEntityManagerFactoryBean entityManagerFactory = new LocalContainerEntityManagerFactoryBean();
        entityManagerFactory.setDataSource(dataSource());
        entityManagerFactory.setPackagesToScan("com.bezkoder.spring.datajpa.model");
        entityManagerFactory.setPersistenceUnitName("com.bezkoder.spring.datajpa.model");
        HibernateJpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();
        vendorAdapter.setDatabase(Database.MYSQL);
        vendorAdapter.setDatabasePlatform("org.hibernate.dialect.MySQL8Dialect");
        entityManagerFactory.setJpaVendorAdapter(vendorAdapter);
        entityManagerFactory.setJpaProperties(hibernateProperties());
        return entityManagerFactory;
    }

    private Properties hibernateProperties() {
        Properties properties = new Properties();
        properties.setProperty("hibernate.hbm2ddl.auto", "update");
        properties.setProperty("hibernate.dialect", "org.hibernate.dialect.MySQL8Dialect");
        return properties;
    }

}</code></pre>
      </div>
      <div class="wiki" style="display: block;"><img src="files/springboot_060.png"
          alt=""></div>
      <div class="wiki" style="display: block;">Elimina el archivo application.properties y prueba que los servicios sigan funcionando correctamente ingresando a <i><a
            href="http://localhost:8080/api/tutorials">http://localhost:8080/api/tutorials</a></i></div>
      <span style="color: #0000ee;">A</span>ñade <em>extends SpringBootServletInitializer</em> en <em>SpringBootDataJpaApplication</em> ubicado en el paquete <em>com.bezkoder.spring.datajpa</em>:
      <div class="wiki" style="display: block;">
        <pre><code class="java">@SpringBootApplication
public class SpringBootDataJpaApplication extends SpringBootServletInitializer {

	public static void main(String[] args) throws Exception {
		SpringApplication.run(SpringBootDataJpaApplication.class, args);

	}
}
</code></pre> </div>
      <div class="wiki" style="display: block;">Ahora configura el <em>pom.xml</em> agregando la dependencia de OpenXava, el <em>finalName</em> es opcional pero lo usaremos en este ejemplo:
        <div class="wiki" style="display: block;">
          <pre><code class="xml">&lt;packaging&gt;war&lt;/packaging&gt;<br><br>&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;org.openxava&lt;/groupId&gt;
        &lt;artifactId&gt;openxava&lt;/artifactId&gt;
        &lt;version&gt;7.1&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;<br><br>&lt;build&gt;
    &lt;finalName&gt;springbootdatajpa&lt;/finalName&gt;
&lt;/build&gt;<br></code></pre>
        </div>
      </div>
      <div class="wiki" style="display: block;">Por último, copia los siguientes archivos y carpetas del proyecto OpenXava al proyecto Spring Boot bajo la misma ruta:</div>
      <ul>
        <li>Todos los archivos y carpetas de <em>src/main/resources</em>.</li>
        <li>La carpeta <em>webapp </em>ubicado en <em>src/main</em>.</li>
      </ul>
      <p><img src="files/springboot_070.png" alt=""></p>
      <p>Opcional: modificar el archivo <em>naviox.properties</em> de la carpeta <em>src/main/resources</em> quitando # a las líneas de <em>autologinUser </em>y <em>autologinPassword</em></p>
      <p><img src="files/springboot_080.png" alt=""></p>
      <p>Debería quedar con estos cambios:</p>
      <p><img src="files/springboot_090.png" alt=""></p>
      <ul>
      </ul>
      <div class="wiki" style="display: block;">
        <h2>Ejecutar aplicacion</h2>
        <p>Recuerda tener configurado <em>JAVA_HOME</em> y hacer los siguientes pasos antes de ejecutar la aplicación:</p>
        <ul>
          <li><em>Maven &gt; update project</em></li>
          <em> </em>
          <li><em>Maven clean</em></li>
          <em> </em>
          <li><em>Maven package</em></li>
        </ul>
        <p>Copia el archivo <em>springbootdatajpa.war</em> de la carpeta <em>target </em>a la carpeta <em>webapp </em>donde tienes instalado Tomcat 9 y ejecuta <em>startup.bat</em> desde la carpeta <em>bin</em></p>
        <p><img src="files/springboot_100.png" alt=""></p>
        <p>Abre el navegador e ingresa al siguiente url para abrir la aplicación OpenXava (inicia sesión con admin/admin si no has hecho el paso opcional): <br>
          <i><a href="http://localhost:8080/springbootdatajpa">http://localhost:8080/springbootdatajpa</a></i></p>
        <p><img src="files/springboot_110.png" alt=""></p>
        <p>Aprovechando las vistas que genera OpenXava con las entidades del proyecto ya puedes realizar operaciones CRUD.</p>
        <p>Comprueba que los servicios del proyecto Spring Boot estén funcionando: <i><a
              href="http://localhost:8080/springbootdatajpa/api/tutorials">http://localhost:8080/springbootdatajpa/api/tutorials</a></i></p>
        <p>Verás que en vez de devolver un json, está devolviendo un xml, esto es debido al bug de la libreria JasperReports que trae OpenXava, lo resolveremos momentáneamente en este ejemplo excluyendo una dependencia de esa libreria, que no es recomendable hacerlo en producción:</p>
        <pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.openxava&lt;/groupId&gt;
    &lt;artifactId&gt;openxava&lt;/artifactId&gt;
    &lt;version&gt;7.1.1&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;<br></code></pre>
        <p></p>
        <p>Si deseas quitar springbootdatajpa del url, simplemente renombra el archivo springbootdatajpa.war a ROOT.war ubicado en la carpeta de webapps, con esto ingresas a la aplicación OpenXava con el url <i><a
              href="http://localhost:8080">http://localhost:8080</a></i> y a los servicios como antes con <i><a
              href="http://localhost:8080/api/tutorials">http://localhost:8080/api/tutorial<span
                style="color: #505050;">s</span></a></i></p>
        <p><br>
        </p>
        <p><br>
          <code></code></p>
      </div>
    </div>
  </body>
</html>
